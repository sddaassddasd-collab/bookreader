:root{
  --bg:#0f172a; --panel:#111827; --fg:#e5e7eb; --muted:#94a3b8;
  --accent:#22c55e; --danger:#ef4444; --blue:#38bdf8; --green:#22c55e;
  --border:rgba(255,255,255,.08); --radius:16px;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif}

header{position:sticky;top:0;z-index:5;background:rgba(15,23,42,.9);backdrop-filter:blur(8px);
  border-bottom:1px solid var(--border)}
.wrap{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;gap:12px}
.status{background:#1f2937;border:1px solid var(--border);border-radius:999px;padding:6px 12px;color:var(--muted);font-size:13px}

.main{max-width:1200px;margin:0 auto;width:100%;padding:16px}
.layout{display:grid;grid-template-columns:1fr 360px;gap:16px;min-height:100vh}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:14px}
.editor{padding:14px}
.reader-wrap{padding:12px}

.input-label{display:block;margin:0 0 8px 2px;color:var(--muted);font-size:13px}
textarea{
  width:100%;min-height:180px;background:#0b1220;color:var(--fg);border:1px solid var(--border);
  border-radius:12px;padding:12px;font-size:15px;line-height:1.6;resize:vertical;
}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.sync-box{margin-top:4px}
.sync-row{align-items:center}
.sync-row input{
  flex:1;min-width:160px;background:#0b1220;border:1px solid var(--border);
  border-radius:12px;color:var(--fg);padding:10px 12px;
}
.sync-row button{white-space:nowrap}
button{
  background:var(--accent);color:#07210f;border:none;border-radius:999px;padding:10px 14px;font-weight:600;
  cursor:pointer;transition:transform .05s ease;box-shadow:0 6px 20px rgba(34,197,94,.25)
}
button.secondary{background:#1f2937;color:var(--fg);box-shadow:none;border:1px solid var(--border)}
button.ghost{background:transparent;color:var(--muted);border:1px dashed var(--border);box-shadow:none}
button.danger{background:var(--danger);color:#fff}
button:disabled{opacity:.6;cursor:not-allowed}
button:active{transform:translateY(1px)}
.select-sm{min-width:96px;background:#0b1220;border:1px solid var(--border);border-radius:12px;color:var(--fg);padding:10px 12px}

.reader{
  padding:16px;line-height:1.8;min-height:240px;white-space:pre-wrap;
  background:#0b1220;border:1px solid var(--border);border-radius:12px;overflow:auto;max-height:65vh;
}
.reader .word{
  cursor:pointer;
  padding:1px 2px;
  border-radius:6px;
  transition:background .15s, outline-color .15s, transform .08s ease;
  position:relative;
  display:inline-block;
  outline-offset:2px;
}
.reader .word:hover{ background:rgba(255,255,255,.06) }
.reader .word.clicked::after{
  content:"";
  position:absolute;
  inset:-4px;
  border-radius:8px;
  pointer-events:none;
  box-shadow: 0 0 0 0 rgba(56,189,248,.65);
  animation: ringPulse .55s ease-out forwards;
  z-index:1;
}
.reader .word.clicked{ transform: scale(1.06); animation: popBack .55s ease-out; }
@keyframes ringPulse{
  0%   { box-shadow: 0 0 0 0 rgba(56,189,248,.65); opacity:1; }
  60%  { box-shadow: 0 0 0 10px rgba(56,189,248,.20); opacity:1; }
  100% { box-shadow: 0 0 0 14px rgba(56,189,248,0);  opacity:0; }
}
@keyframes popBack{ 0%{transform:scale(1.06)} 100%{transform:scale(1.00)} }
.reader .word.tapping { transform: scale(1.04); transition: transform .08s ease; }
.reader .word.tapping::after{
  content:""; position:absolute; inset:-4px; border-radius:8px; pointer-events:none;
  box-shadow: 0 0 0 0 rgba(56,189,248,.55); animation: ringPulse .45s ease-out forwards; z-index:1;
}
.reader .word:active { transform: scale(1.03) }
.reader{ padding-bottom: 72px; }
.seg{position:relative; padding-left:20px; margin:4px 0;}
.seg.empty{padding-left:0;}
.seg .playseg{
  position:absolute; left:0; top:0.1em; border:1px solid var(--border);
  background:#0b1220; color:#cbd5e1; border-radius:8px; padding:2px 6px;
  font-size:12px; cursor:pointer; box-shadow:none; display:inline-block;
}
.seg .playseg:hover{background:#1f2937}
.seg.sep{ padding-left:0; margin:6px 0; height:6px; }
.seg.playing{
  outline:2px solid rgba(56,189,248,.6);
  background:linear-gradient(to right, rgba(56,189,248,.10), rgba(56,189,248,.04));
  border-radius:12px;
  transition:background .2s ease, outline-color .2s ease;
}

.reader .hf15{outline:2px solid var(--blue); background:rgba(56,189,248,.10)}
.reader .hf50{outline:1px dashed var(--green); background:rgba(34,197,94,.08)}
.reader .deducted{outline:2px solid var(--danger) !important; background:rgba(239,68,68,.10) !important}

.help{color:var(--muted);font-size:13px;margin-top:8px}
.small{color:var(--muted);font-size:12px}
.label{color:var(--muted);font-size:13px}

.sidebar{padding:12px;display:flex;flex-direction:column;max-height:calc(100vh - 120px)}
.side-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px;flex-wrap:wrap}
.list{flex:1;overflow:auto;border-top:1px solid var(--border);margin-top:8px;padding-top:8px}
.item{
  display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;
  padding:8px;border:1px solid var(--border);border-radius:12px;margin-bottom:8px;background:#0b1220
}
.item .w{font-weight:700}
.item .c{color:var(--muted);font-variant-numeric:tabular-nums}
.item .t{color:var(--muted);font-size:12px}
.tools{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.search{display:flex;gap:6px;margin-top:6px}
.search input, .kblock input, .kblock select{
  flex:1;background:#0b1220;border:1px solid var(--border);border-radius:12px;color:var(--fg);padding:10px 12px
}
.file-btn input{display:none}
.kblock{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.model-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:8px}
.model-select{min-width:220px}
.flex-1{flex:1;min-width:200px}
.number{width:110px;background:#0b1220;border:1px solid var(--border);border-radius:12px;color:var(--fg);padding:10px 12px}

.card{
  position:fixed;right:20px;bottom:20px;z-index:180;max-width:520px;
  background:#111827;border:1px solid var(--border);border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.4)
}
.card header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--border)}
.card .content{padding:12px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#0b1220;border:1px solid var(--border);color:#94a3b8;font-size:12px;margin-right:6px}
.phon{color:#94a3b8;margin-left:6px}
.defs{margin:8px 0 0 0;padding-left:18px}
.defs li{margin:6px 0}
.note-row{display:flex;gap:6px;margin-top:10px}
.note-row input{flex:1;background:#0b1220;border:1px solid var(--border);border-radius:10px;color:#e5e7eb;padding:8px 10px}
.empty{color:#94a3b8;text-align:center;padding:24px}

.analysis{
  position:fixed; left:50%; bottom:64px; transform:translateX(-50%);
  z-index:185; max-width:880px; width:calc(100% - 32px);
  background:#111827; border:1px solid var(--border); border-radius:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.5); display:none;
}
.analysis header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--border)}
.analysis .content{
  padding: 12px;
  max-height: calc(52vh - 84px);
  overflow: auto;
  margin-bottom: 84px;
}
.analysis .sec{margin:10px 0}
.analysis .sec h4{margin:0 0 6px 0; color:#93c5fd; font-size:14px}
.analysis .quote{color:#cbd5e1; background:#0b1220; border:1px solid var(--border); border-radius:12px; padding:10px; white-space:pre-wrap}
.analysis .zh{white-space:pre-wrap; line-height:1.7}
.analysis .list{margin:0; padding-left:18px}
.analysis .list li{margin:6px 0}
.analysis .actions{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
.chip{display:inline-block; padding:2px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; color:#cbd5e1; background:#0b1220}
.analysis .sec.examples{margin-bottom: 64px;}
#analysisCard{ position:fixed; }
#extraQ{
  position: absolute;
  left: 0; right: 0; bottom: 0;
  z-index: 1;
  background:#111827;
  border-top:1px solid var(--border);
  padding:10px 12px;
  border-radius: 0 0 16px 16px;
}
#extraQ input{width: 100%; max-width: none;}

.bottom-bar{
  position:fixed; left:50%; bottom:12px; transform:translateX(-50%);
  z-index:190; display:none; gap:8px; align-items:center;
  background:#0b1220; border:1px solid var(--border); border-radius:999px; padding:8px 10px;
  box-shadow:0 10px 40px rgba(0,0,0,.45)
}
.bottom-bar .status{font-size:12px; color:#94a3b8; padding:0 8px}

.tts-drawer{
  position:fixed; top:20%; left:-260px; width:260px;
  background:#0b1220; border:1px solid var(--border); border-left:none;
  border-radius:0 12px 12px 0; box-shadow:0 10px 40px rgba(0,0,0,.5);
  transition:left .25s ease; z-index:70; padding:12px; display:none;
}
.tts-drawer.show{display:block;}
.tts-drawer:hover, .tts-drawer:focus-within{ left:0; }
.tts-drawer .handle{
  position:absolute; right:-24px; top:0; bottom:0; width:24px;
  background:#0b1220; border:1px solid var(--border); border-left:none;
  border-radius:0 12px 12px 0; display:flex; align-items:center; justify-content:center;
  cursor:ew-resize; color:#94a3b8; font-size:12px;
}
.tts-drawer .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.tts-drawer input[type="range"]{width:150px}

.reader-head{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
.reader-head-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
.progress{display:grid;gap:4px;min-width:220px}
.progress-label{font-size:13px;color:var(--muted)}
.progress-bar{height:8px;background:#1f2937;border-radius:999px;overflow:hidden;border:1px solid var(--border)}
.progress-bar .fill{height:100%;width:0%;background:linear-gradient(90deg, var(--blue), var(--accent));transition:width .2s ease}

.slots{margin-bottom:16px}
.slot-list{display:flex;gap:10px;flex-wrap:wrap}
.slot{
  padding:12px;
  border:1px solid var(--border);
  border-radius:12px;
  background:#0b1220;
  cursor:pointer;
  min-width:210px;
  flex:1 1 200px;
  transition:border-color .15s ease, transform .05s ease;
}
.slot:hover{border-color:rgba(56,189,248,.4)}
.slot.active{outline:2px solid rgba(56,189,248,.35)}
.slot-head{display:flex;justify-content:space-between;align-items:center;gap:8px}
.slot-name{font-weight:700}
.pill{border:1px solid var(--border);border-radius:999px;padding:4px 8px;font-size:12px;color:var(--muted)}
.slot-meta{color:var(--muted);font-size:12px;margin:4px 0}
.slot-progress{display:flex;align-items:center;gap:8px;margin:6px 0}
.slot-progress .bar{flex:1;height:6px;background:#1f2937;border-radius:999px;overflow:hidden}
.slot-progress .bar span{display:block;height:100%;background:linear-gradient(90deg, var(--blue), var(--accent))}
.slot-actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
.slot button{padding:8px 10px;box-shadow:none}
.slot-bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
.slot-title{display:flex;align-items:center;gap:8px;flex:1}
.slot-title input{
  flex:1;background:#0b1220;border:1px solid var(--border);border-radius:12px;color:var(--fg);padding:10px 12px;
}
.active-slot{font-size:18px;font-weight:700}

.immersive-layer{
  position:fixed; inset:0; z-index:120; display:none; padding:16px;
  background:radial-gradient(circle at 20% 20%, rgba(56,189,248,.08), transparent 28%),
             radial-gradient(circle at 80% 10%, rgba(34,197,94,.08), transparent 30%),
             linear-gradient(135deg, rgba(15,23,42,.94), rgba(9,12,22,.97));
  backdrop-filter: blur(10px);
}
.immersive-layer.show{display:flex; flex-direction:column;}
.immersive-shell{flex:1; max-width:1200px; width:100%; margin:0 auto; display:flex; flex-direction:column; gap:12px;}
.immersive-top{
  display:flex; justify-content:space-between; align-items:center; gap:10px;
  padding:12px 14px; background:rgba(15,23,42,.85); border:1px solid var(--border);
  border-radius:14px; box-shadow:0 14px 40px rgba(0,0,0,.35);
}
.immersive-host{flex:1; display:flex;}
.immersive-layer .reader-wrap{
  width:100%; display:flex; flex-direction:column; max-height:none; height:calc(100vh - 130px);
  padding:18px; background:#0b1220; border-radius:18px; box-shadow:0 20px 80px rgba(0,0,0,.6);
}
.immersive-layer .reader-head{
  width:100%; margin-bottom:8px; padding-bottom:10px; border-bottom:1px solid var(--border);
}
.immersive-layer .reader{
  flex:1; max-height:none; height:auto; padding:18px; font-size:17px; line-height:1.9;
  background:#0b1220; border:1px solid var(--border);
}
.immersive-layer .help, .immersive-layer .small{color:#cbd5e1;}
body.immersive-on{overflow:hidden;}

@media (max-width: 980px){
  .layout{grid-template-columns:1fr}
  .sidebar{height:auto;max-height:none}
  .card{left:12px; right:12px; bottom:12px; max-width:none}
  .analysis{left:50%; right:auto; transform:translateX(-50%); max-width:none}
  .slot{flex:1 1 100%}
}
